<header>
  <h1>Sparky's Electric</h1>
  <p>Powered by <strong>Greenput</strong>. Real-time estimates, no waiting.</p>
</header>

<!-- PHASE 1: LEAD INTAKE (The "Consent" Event) -->
@if (!currentReceipt()) {
  <section class="lead-form-section">
    <h2>Get an Instant Estimate</h2>
    <form (ngSubmit)="submitLead()" #leadForm="ngForm">
      <fieldset class="form-group">
        <label for="name">Full Name</label>
        <input
          type="text"
          id="name"
          name="name"
          [(ngModel)]="formData.name"
          required
        />
      </fieldset>
      <fieldset class="form-group">
        <label for="email">Email Address</label>
        <input
          type="email"
          id="email"
          name="email"
          [(ngModel)]="formData.email"
          required
        />
      </fieldset>
      <fieldset class="form-group">
        <label for="details">Project Details</label>
        <textarea
          id="details"
          name="details"
          [(ngModel)]="formData.details"
          required
          placeholder="e.g. Rewiring a 1920s bungalow..."
        ></textarea>
      </fieldset>

      <section
        class="consent-disclosure"
        aria-label="Privacy and Consent Notice"
      >
        <p>
          <strong>Transparency Notice:</strong> By clicking "See Price", you
          authorize us to:
        </p>
        <ul>
          <li>Calculate a real-time estimate for your project</li>
          <li>Store your contact details (Retention: 90 days)</li>
          <li>
            <strong>If you decline our estimate:</strong> Match you with other
            local pros in the Greenput Pool
          </li>
        </ul>
        <p class="small">
          We do not sell your data to ad networks. You are in control.
        </p>
        <!-- Portability/Audit Pre-check -->
        <div class="audit-preview">
          <small>Data Categories: {{ getCategoryNames() }}</small>
        </div>
      </section>

      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="!leadForm.form.valid"
      >
        See Instant Price
      </button>
    </form>
  </section>
}

<!-- PHASE 2: CONSENT DASHBOARD (Post-Submission) -->
@if (currentReceipt()) {
  <section class="success-dashboard">
    <div class="success-message" role="alert" aria-live="polite">
      <h2>Request Sent!</h2>
      <p>Your data was securely processed. Here is your proof of consent.</p>
    </div>

    <article greenput-receipt-viewer [receipt]="currentReceipt()!"></article>

    <div class="data-controls">
      <h3>Your Data Protocol</h3>
      <div class="button-group">
        <button class="btn btn-outline" (click)="exportData()">
          ‚¨áÔ∏è Export My Data (JSON)
        </button>
        <button class="btn btn-warning" (click)="revokeConsent()">
          üö´ Revoke & Delete
        </button>
      </div>
    </div>
  </section>
}

<!-- HISTORY & EDUCATION -->
@if (revocationHistory().length > 0) {
  <section class="history-section">
    <h3>History</h3>
    <section
      greenput-revocation-history
      [history]="revocationHistory()"
    ></section>
  </section>
}

<section class="info-section">
  <h3>How we handle your data</h3>
  <div class="categories-grid">
    @for (cat of categories; track cat.id) {
      <article greenput-data-category [category]="cat"></article>
    }
  </div>
</section>
